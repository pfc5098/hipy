---
title: "01_analysis"
format: html
editor: visual
editor_options: 
  chunk_output_type: console
---

```{r}
library(tidyverse)
library(janitor)
library(fpp3)
library(data.table)
library(here)
```

```{r}
df <- read_csv("https://pfc5098.s3.us-west-2.amazonaws.com/rei/County_zhvi_uc_sfr_tier_0.33_0.67_sm_sa_month.csv")

df1 <- df %>% 
  select(-c(RegionID, SizeRank, RegionType, StateName, StateCodeFIPS, MunicipalCodeFIPS)) %>% 
  pivot_longer(cols = -c(1, 2, 3), names_to = "yr_mnth", values_to = "price", values_drop_na = TRUE) %>% 
  clean_names()
```

```{r}
tsbl <- df1 %>% 
  mutate(yr_mnth = yearmonth(yr_mnth)) %>% 
  as_tsibble(key = c(region_name, state, metro), index = yr_mnth)

fwrite(tsbl, "/Users/pengchen/hipy/rei/tsbl.csv")
```

```{r}
regions <- c("Alameda County", "Boone County")

tsbl %>% 
  filter(region_name %in% regions, state %in% c("MO", "CA")) %>% 
  autoplot(.vars = price) +
  theme_light()
```



